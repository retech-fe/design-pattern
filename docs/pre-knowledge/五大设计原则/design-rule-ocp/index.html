<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pre-knowledge/五大设计原则/design-rule-ocp">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">开放封闭原则 | Design Pattern</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://retech-fe.github.io/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-ocp"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="开放封闭原则 | Design Pattern"><meta data-rh="true" name="description" content="How do I find you when I cannot solve this problem"><meta data-rh="true" property="og:description" content="How do I find you when I cannot solve this problem"><link data-rh="true" rel="icon" href="/design-pattern/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://retech-fe.github.io/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-ocp"><link data-rh="true" rel="alternate" href="https://retech-fe.github.io/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-ocp" hreflang="en"><link data-rh="true" rel="alternate" href="https://retech-fe.github.io/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-ocp" hreflang="x-default"><link rel="stylesheet" href="/design-pattern/assets/css/styles.f89c3e10.css">
<link rel="preload" href="/design-pattern/assets/js/runtime~main.dd240863.js" as="script">
<link rel="preload" href="/design-pattern/assets/js/main.105245b7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/design-pattern/"><div class="navbar__logo"><img src="/design-pattern/img/logo.svg" alt="Re:Tech FE" class="themedImage_ToTc themedImage--light_HNdA"><img src="/design-pattern/img/logo.svg" alt="Re:Tech FE" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Design Pattern</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/retech-fe/design-pattern" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design-pattern/docs/intro">序言</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/design-pattern/docs/category/前置知识">前置知识</a><button aria-label="Toggle the collapsible sidebar category &#x27;前置知识&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/design-pattern/docs/category/solid五大设计原则">SOLID五大设计原则</a><button aria-label="Toggle the collapsible sidebar category &#x27;SOLID五大设计原则&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-srp">S 单一职责原则</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-ocp">O 开放封闭原则</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/design-pattern/docs/pre-knowledge/五大设计原则/disign-rule-liskov">L 里氏替换原则</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-isp">I 接口隔离原则</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-dip">D 依赖倒置原则</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/design-pattern/docs/pre-knowledge/design-rule-lod">迪米特法则</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/design-pattern/docs/category/创建型模式">创建型模式</a><button aria-label="Toggle the collapsible sidebar category &#x27;创建型模式&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/design-pattern/docs/category/结构型模式">结构型模式</a><button aria-label="Toggle the collapsible sidebar category &#x27;结构型模式&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/design-pattern/docs/category/行为型模式">行为型模式</a><button aria-label="Toggle the collapsible sidebar category &#x27;行为型模式&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/design-pattern/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/design-pattern/docs/category/前置知识"><span itemprop="name">前置知识</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/design-pattern/docs/category/solid五大设计原则"><span itemprop="name">SOLID五大设计原则</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">O 开放封闭原则</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>开放封闭原则</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是开放封闭原则ocp">什么是开放封闭原则（OCP）<a class="hash-link" href="#什么是开放封闭原则ocp" title="Direct link to heading">​</a></h2><p>开放封闭原则的英文全称是 <code>Open Closed Principle</code>，简写为 <code>OCP</code>。</p><p>它的英文描述是：software entities (modules, classes, functions, etc.) should be open for extension , but closed for modification。</p><p>我们把它翻译成中文就是：软件实体（模块、类、方法等）应该“对扩展开放、对修改关闭”。</p><p>这个描述比较简略，如果我们详细表述一下，那就是，添加一个新的功能应该是，在已有代码基础上扩展代码（新增模块、类、方法等），而非修改已有代码（修改模块、类、方法等）。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="重要性">重要性<a class="hash-link" href="#重要性" title="Direct link to heading">​</a></h2><p>开闭原则是<code>SOLID</code> 中最难理解、最难掌握，同时也是最有用的一条原则。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="难理解">难理解<a class="hash-link" href="#难理解" title="Direct link to heading">​</a></h3><ul><li>怎样的代码改动才被定义为&#x27;扩展&#x27;？</li><li>怎样的代码改动才被定义为&#x27;修改&#x27;？</li><li>怎么才算满足或违反&#x27;开闭原则&#x27;？</li><li>修改代码就一定意味着违反&#x27;开闭原则&#x27;吗？</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="难掌握">难掌握<a class="hash-link" href="#难掌握" title="Direct link to heading">​</a></h3><ul><li>如何做到‘对扩展开放、修改关闭’？</li><li>如何在项目中灵活地应用‘开闭原则’，以避免在追求扩展性的同时影响到代码的可读性？”</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="最重要">最重要<a class="hash-link" href="#最重要" title="Direct link to heading">​</a></h3><p>扩展性是代码质量最重要的衡量标准之一。</p><p>在 23 种经典设计模式中，大部分设计模式都是为了解决代码的扩展性问题而存在的，主要遵从的设计原则就是开闭原则。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何理解对扩展开放修改关闭">如何理解“对扩展开放、修改关闭”？<a class="hash-link" href="#如何理解对扩展开放修改关闭" title="Direct link to heading">​</a></h2><p>下面是一个 <code>API </code>接口监控告警的例子。</p><ul><li><code>AlertRule</code> 存储告警规则，可以自由设置。</li><li><code>Notification</code> 是告警通知类，支持邮件、短信、微信、手机等多种通知渠道。</li><li><code>NotificationEmergencyLevel</code> 表示通知的紧急程度，包括 <code>SEVERE</code>（严重）、<code>URGENCY</code>（紧急）、<code>NORMAL</code>（普通）、<code>TRIVIAL</code>（无关紧要），不同的紧急程度对应不同的发送渠道。</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Alert {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private AlertRule rule;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Notification notification;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Alert(AlertRule rule, Notification notification) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.rule = rule;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.notification = notification;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void check(String api, long requestCount, long errorCount, long durationOfSeconds) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long tps = requestCount / durationOfSeconds;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (tps &gt; rule.getMatchedRule(api).getMaxTps()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (errorCount &gt; rule.getMatchedRule(api).getMaxErrorCount()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>业务逻辑主要集中在 <code>check() </code>函数中。当接口的 <code>TPS</code> 超过某个预先设置的最大值时，以及当接口请求出错数大于某个最大允许值时，就会触发告警，通知接口的相关负责人或者团队。</p><p>现在，如果我们需要添加一个功能，当每秒钟接口超时请求个数，超过某个预先设置的最大阈值时，我们也要触发告警发送通知。</p><p>这个时候，我们该如何改动代码呢？</p><p>主要的改动有两处：</p><ul><li>第一处是修改 check() 函数的入参，添加一个新的统计数据 timeoutCount，表示超时接口请求数；</li><li>第二处是在 check() 函数中添加新的告警逻辑。具体的代码改动如下所示：</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Alert {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...省略AlertRule/Notification属性和构造函数...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 改动一：添加参数timeoutCount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void check(String api, long requestCount, long errorCount, long timeoutCount, long durationOfSeconds) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long tps = requestCount / durationOfSeconds;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (tps &gt; rule.getMatchedRule(api).getMaxTps()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (errorCount &gt; rule.getMatchedRule(api).getMaxErrorCount()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 改动二：添加接口超时处理逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long timeoutTps = timeoutCount / durationOfSeconds;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (timeoutTps &gt; rule.getMatchedRule(api).getMaxTimeoutTps()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样的代码修改实际上存在挺多问题的。</p><ul><li><p>一方面，我们对接口进行了修改，这就意味着调用这个接口的代码都要做相应的修改。另一方面，修改了 <code>check() </code>函数，相应的单元测试都需要修改</p></li><li><p>上面的代码改动是基于“修改”的方式来实现新功能的。如果我们遵循开闭原则，也就是“对扩展开放、对修改关闭”。那如何通过“扩展”的方式，来实现同样的功能呢？</p></li><li><p>我们先重构一下之前的 <code>Alert</code> 代码，让它的扩展性更好一些。重构的内容主要包含两部分：第一部分是将<code> check()</code> 函数的多个入参封装成 <code>ApiStatInfo </code>类；第二部分是引入 handler 的概念，将<code> if</code> 判断逻辑分散在各个 <code>handler</code> 中。具体的代码实现如下所示：</p></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Alert {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;AlertHandler&gt; alertHandlers = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addAlertHandler(AlertHandler alertHandler) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.alertHandlers.add(alertHandler);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void check(ApiStatInfo apiStatInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (AlertHandler handler : alertHandlers) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handler.check(apiStatInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApiStatInfo {//省略constructor/getter/setter方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String api;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long requestCount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long errorCount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long durationOfSeconds;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class AlertHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected AlertRule rule;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected Notification notification;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AlertHandler(AlertRule rule, Notification notification) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.rule = rule;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.notification = notification;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract void check(ApiStatInfo apiStatInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TpsAlertHandler extends AlertHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public TpsAlertHandler(AlertRule rule, Notification notification) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(rule, notification);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void check(ApiStatInfo apiStatInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long tps = apiStatInfo.getRequestCount()/ apiStatInfo.getDurationOfSeconds();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (tps &gt; rule.getMatchedRule(apiStatInfo.getApi()).getMaxTps()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ErrorAlertHandler extends AlertHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ErrorAlertHandler(AlertRule rule, Notification notification){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(rule, notification);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void check(ApiStatInfo apiStatInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (apiStatInfo.getErrorCount() &gt; rule.getMatchedRule(apiStatInfo.getApi()).getMaxErrorCount()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的代码是对<code>Alert</code>的重构，我们再来看下，重构之后的<code>Alert</code>该如何使用呢？具体的使用代码我也写在这里了。</p><p>其中，<code>ApplicationContext</code> 是一个单例类，负责 <code>Alert</code> 的创建、组装（<code>alertRule</code> 和 <code>notification</code> 的依赖注入）、初始化（添加 <code>handlers</code>）工作。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationContext {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private AlertRule alertRule;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Notification notification;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Alert alert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void initializeBeans() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alertRule = new AlertRule(/*.省略参数.*/); //省略一些初始化代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        notification = new Notification(/*.省略参数.*/); //省略一些初始化代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert = new Alert();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert.addAlertHandler(new TpsAlertHandler(alertRule, notification));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert.addAlertHandler(new ErrorAlertHandler(alertRule, notification));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Alert getAlert() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return alert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 饿汉式单例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final ApplicationContext instance = new ApplicationContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ApplicationContext() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initializeBeans();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static ApplicationContext getInstance() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return instance;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Demo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ApiStatInfo apiStatInfo = new ApiStatInfo();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...省略设置apiStatInfo数据值的代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ApplicationContext.getInstance().getAlert().check(apiStatInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现在，我们再来看下，基于重构之后的代码，如果再添加上面讲到的那个新功能，每秒钟接口超时请求个数超过某个最大阈值就告警，我们又该如何改动代码呢？主要的改动有下面四处。</p><ul><li>第一处改动是：在 <code>ApiStatInfo</code> 类中添加新的属性<code> timeoutCount</code>。</li><li>第二处改动是：添加新的 <code>TimeoutAlertHander </code>类。</li><li>第三处改动是：在 <code>ApplicationContext</code> 类的<code> initializeBeans()</code> 方法中，往<code>alert</code>对象中注册新的 <code>timeoutAlertHandler</code>。</li><li>第四处改动是：在使用 <code>Alert</code> 类的时候，需要给 <code>check() </code>函数的入参 <code>apiStatInfo </code>对象设置 <code>timeoutCount</code> 的值。</li></ul><p>改动之后的代码如下所示：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Alert { // 代码未改动... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApiStatInfo {//省略constructor/getter/setter方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String api;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long requestCount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long errorCount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long durationOfSeconds;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long timeoutCount; // 改动一：添加新字段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class AlertHandler { //代码未改动... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TpsAlertHandler extends AlertHandler {//代码未改动...}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ErrorAlertHandler extends AlertHandler {//代码未改动...}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 改动二：添加新的handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TimeoutAlertHandler extends AlertHandler {//省略代码...}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationContext {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private AlertRule alertRule;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Notification notification;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Alert alert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void initializeBeans() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alertRule = new AlertRule(/*.省略参数.*/); //省略一些初始化代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        notification = new Notification(/*.省略参数.*/); //省略一些初始化代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert = new Alert();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert.addAlertHandler(new TpsAlertHandler(alertRule, notification));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert.addAlertHandler(new ErrorAlertHandler(alertRule, notification));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 改动三：注册handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert.addAlertHandler(new TimeoutAlertHandler(alertRule, notification));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   //...省略其他未改动代码...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Demo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ApiStatInfo apiStatInfo = new ApiStatInfo();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...省略apiStatInfo的set字段代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        apiStatInfo.setTimeoutCount(289); // 改动四：设置tiemoutCount值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ApplicationContext.getInstance().getAlert().check(apiStatInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重构之后的代码更加灵活和易扩展。如果我们要想添加新的告警逻辑，只需要基于扩展的方式创建新的 handler 类即可，不需要改动原来的 check() 函数的逻辑。而且，我们只需要为新的 handler 类添加单元测试，老的单元测试都不会失败，也不用修改。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="修改代码就意味着违背开闭原则吗">修改代码就意味着违背开闭原则吗？<a class="hash-link" href="#修改代码就意味着违背开闭原则吗" title="Direct link to heading">​</a></h2><p>看了上面重构之后的代码，你可能还会有疑问：在添加新的告警逻辑的时候，尽管改动二（添加新的 handler 类）是基于扩展而非修改的方式来完成的，但改动一、三、四貌似不是基于扩展而是基于修改的方式来完成的，那改动一、三、四不就违背了开闭原则吗？</p><p>我们先来分析一下改动一：往 ApiStatInfo 类中添加新的属性 timeoutCount。</p><p>实际上，我们不仅往 ApiStatInfo 类中添加了属性，还添加了对应的 getter/setter 方法。那这个问题就转化为：给类中添加新的属性和方法，算作“修改”还是“扩展”？</p><p>我们再一块回忆一下开闭原则的定义：软件实体（模块、类、方法等）应该“对扩展开放、对修改关闭”。</p><p>从定义中，我们可以看出，开闭原则可以应用在不同粒度的代码中，可以是模块，也可以类，还可以是方法（及其属性）。</p><p>同样一个代码改动，在粗代码粒度下，被认定为“修改”，在细代码粒度下，又可以被认定为“扩展”。</p><p>比如，改动一，添加属性和方法相当于修改类，在类这个层面，这个代码改动可以被认定为“修改”；但这个代码改动并没有修改已有的属性和方法，在方法（及其属性）这一层面，它又可以被认定为“扩展”。</p><p>实际上，我们也没必要纠结某个代码改动是“修改”还是“扩展”，更没必要太纠结它是否违反“开闭原则”。</p><p>/<strong>我们回到这条原则的设计初衷：只要它没有破坏原有的代码的正常运行，没有破坏原有的单元测试，我们就可以说，这是一个合格的代码改动。</strong>/</p><p>我们再来分析一下改动三和改动四：</p><p>在 <code>ApplicationContext</code> 类的 <code>initializeBeans()</code> 方法中，往 alert 对象中注册新的 <code>timeoutAlertHandler</code>；在使用 <code>Alert </code>类的时候，需要给 <code>check() </code>函数的入参 <code>apiStatInfo</code> 对象设置 <code>timeoutCount </code>的值。</p><ul><li><p>这两处改动都是在方法内部进行的，不管从哪个层面（模块、类、方法）来讲，都不能算是“扩展”，而是地地道道的“修改”。不过，有些修改是在所难免的，是可以被接受的。为什么这么说呢？我来解释一下。</p></li><li><p>在重构之后的<code> Alert</code> 代码中，我们的核心逻辑集中在 <code>Alert</code> 类及其各个 <code>handler</code> 中，当我们在添加新的告警逻辑的时候，<code>Alert</code> 类完全不需要修改，而只需要扩展一个新 <code>handler </code>类。如果我们把<code>Alert</code>类及各个 <code>handler</code> 类合起来看作一个“模块”，那模块本身在添加新的功能的时候，完全满足开闭原则。</p></li><li><p>而且，我们要认识到，添加一个新功能，不可能任何模块、类、方法的代码都不“修改”，这个是做不到的。类需要创建、组装、并且做一些初始化操作，才能构建成可运行的的程序，这部分代码的修改是在所难免的。我们要做的是尽量让修改操作更集中、更少、更上层，尽量让最核心、最复杂的那部分逻辑代码满足开闭原则。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何做到对扩展开放修改关闭">如何做到“对扩展开放、修改关闭”？<a class="hash-link" href="#如何做到对扩展开放修改关闭" title="Direct link to heading">​</a></h2><p>在写代码的时候后，我们要多花点时间往前多思考一下，这段代码未来可能有哪些需求变更、如何设计代码结构，事先留好扩展点，以便在未来需求变更的时候，不需要改动代码整体结构、做到最小代码改动的情况下，新的代码能够很灵活地插入到扩展点上，做到“对扩展开放、对修改关闭”。</p><p>还有，在识别出代码可变部分和不可变部分之后，我们要将可变部分封装起来，隔离变化，提供抽象化的不可变接口，给上层系统使用。当具体的实现发生变化的时候，我们只需要基于相同的抽象接口，扩展一个新的实现，替换掉老的实现即可，上游系统的代码几乎不需要修改。</p><p>多使用多态、依赖注入、基于接口而非实现编程，以及前面提到的抽象意识，说的都是同一种设计思路，只是从不同的角度、不同的层面来阐述而已。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何在项目中灵活应用开闭原则">如何在项目中灵活应用开闭原则？<a class="hash-link" href="#如何在项目中灵活应用开闭原则" title="Direct link to heading">​</a></h2><p>对于一些比较确定的、短期内可能就会扩展，或者需求改动对代码结构影响比较大的情况，或者实现成本不高的扩展点，在编写代码的时候之后，我们就可以事先做些扩展性设计。</p><p>但对于一些不确定未来是否要支持的需求，或者实现起来比较复杂的扩展点，我们可以等到有需求驱动的时候，再通过重构代码的方式来支持扩展的需求</p><p>为了更好地支持扩展性，我们对代码进行了重构，重构之后的代码要比之前的代码复杂很多，理解起来也更加有难度。很多时候，我们都需要在扩展性和可读性之间做权衡。在某些场景下，代码的扩展性很重要，我们就可以适当地牺牲一些代码的可读性；在另一些场景下，代码的可读性更加重要，那我们就适当地牺牲一些代码的可扩展性。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/retech-fe/design-pattern/blob/main/docs/02-pre-knowledge/五大设计原则/02-design-rule-ocp.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-11-09T00:00:00.000Z">Nov 9, 2022</time></b> by <b>pengfei.zuo</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/design-pattern/docs/pre-knowledge/五大设计原则/design-rule-srp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">S 单一职责原则</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/design-pattern/docs/pre-knowledge/五大设计原则/disign-rule-liskov"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">L 里氏替换原则</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是开放封闭原则ocp" class="table-of-contents__link toc-highlight">什么是开放封闭原则（OCP）</a></li><li><a href="#重要性" class="table-of-contents__link toc-highlight">重要性</a><ul><li><a href="#难理解" class="table-of-contents__link toc-highlight">难理解</a></li><li><a href="#难掌握" class="table-of-contents__link toc-highlight">难掌握</a></li><li><a href="#最重要" class="table-of-contents__link toc-highlight">最重要</a></li></ul></li><li><a href="#如何理解对扩展开放修改关闭" class="table-of-contents__link toc-highlight">如何理解“对扩展开放、修改关闭”？</a></li><li><a href="#修改代码就意味着违背开闭原则吗" class="table-of-contents__link toc-highlight">修改代码就意味着违背开闭原则吗？</a></li><li><a href="#如何做到对扩展开放修改关闭" class="table-of-contents__link toc-highlight">如何做到“对扩展开放、修改关闭”？</a></li><li><a href="#如何在项目中灵活应用开闭原则" class="table-of-contents__link toc-highlight">如何在项目中灵活应用开闭原则？</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Design Pattern, Re:Tech FE.</div></div></div></footer></div>
<script src="/design-pattern/assets/js/runtime~main.dd240863.js"></script>
<script src="/design-pattern/assets/js/main.105245b7.js"></script>
</body>
</html>